variables:
  DEPLOY_REPO: 'front-end-deploy'
  DEPLOY_REPO_URL: 'https://gitlab-ci-token:${GITLAB_USER_API_TOKEN}@gitlab.ebi.ac.uk/uniprot/front-end/${DEPLOY_REPO}.git'

stages:
  - deploy

deploy:
  only:
    refs:
      - dev
  stage: deploy
  image:
    name: alpine/helm:3.8.2
    entrypoint: ['']
  script:
    - NAME=uniprot-website-dev
    - git clone $DEPLOY_REPO_URL
    - ./deploy/pre-deploy.sh HH $NAME
    - helm install -f ${NAME}.yaml $NAME $DEPLOY_REPO
    - ./deploy/post-deploy.sh
