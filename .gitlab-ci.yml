variables:
  DEPLOY_REPO: 'front-end-deploy'
  DEPLOY_REPO_URL: 'https://gitlab-ci-token:${GITLAB_USER_API_TOKEN}@gitlab.ebi.ac.uk/uniprot/front-end/${DEPLOY_REPO}.git'

stages:
  - deploy

deploy:
  only:
    refs:
      - dev
  stage: deploy
  image: alpine/k8s:1.22.6
  script:
    - git clone $DEPLOY_REPO_URL
    - ./deploy/pre-deploy.sh HH uniprot-front-end-dev
    - helm install -f ${DEPLOY_REPO}/uniprot-website-dev.yaml uniprot-website-dev $DEPLOY_REPO
    - ./deploy/post-deploy.sh
